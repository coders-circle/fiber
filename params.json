{"name":"Fiber","tagline":"A simple and light, yet powerful MVC framework in PHP","body":"# fiber\r\n\r\n**fiber** is a simple, lightweight php framework based on MVC pattern. *fiber* is built for helping development of php projects, when heavy frameworks are not desired.\r\n\r\n## User Guide\r\n\r\n### Router\r\n\r\nAll routes are defined as rules in the `Router` class inside the *classes/Router.php* file. A rule defines the controller or the template that handles a path.\r\n\r\nEach rule is of the form:\r\n\r\n```php\r\n// type can be 'controller' or 'template'\r\n'path' => array(type, controller_or_template_name)\r\n```\r\n\r\nAn example of a set of rules is:\r\n\r\n```php\r\n$this->routing_rules = array(\r\n    // Default rule\r\n    \"default\" => \"fiber\",\r\n\r\n    // Template redirection rules\r\n    \"fiber\" => array(\"template\", \"fiber.html\"),\r\n\r\n    // Controller redirection rules\r\n    \"example\" => array('controller', 'ExampleController'),\r\n);\r\n```\r\n\r\nHere the path `/fiber/` is routed to the template file *views/fiber.html* and the path `/example/` is handled by the controller `ExampleController` in the file *controls/ExampleController.php*. The default rule, for when no path is\r\nprovided in the url, is the \"fiber\" template rule.\r\n\r\nTemplates are just HTML pages that may include some template tags for server side processing. For simple pages that has no need to access database or perform any complicated processing, one can simply route the url directly to a template.\r\n\r\nControllers perform some processing, optionally accessing the database, and pass the processed data to a corresponding view. The view is then responsible for presenting text or HTML output to the user. A view is mostly built from a template.\r\n\r\n### Controllers and Views\r\n\r\nEvery controller is held in a class derived from the `Controller` base class and is stored inside the *controls* directory. A controller returns a `View` object which acts as a renderer, that returns what is to be presented to the user.\r\n\r\nA view can be constructed directly from some text that you want to present or can be constructed from a template, which defines the HTML page to be presented. When creating from template, you can pass data to the view, which data you can\r\nuse in the template. The `TemplateView` processes template which includes replacing the data passed from the controller and\r\nreturns the final result.\r\n\r\nAn example controller is:\r\n\r\n```php\r\n<?php\r\n\r\nclass ExampleController extends Controller\r\n{\r\n    public function get()\r\n    {\r\n        return new TemplateView('example.html');\r\n        // return new TemplateView('example.html', array(\"my_data\"=>\"my_value\"));\r\n        // return new View(\"Some text that is displayed as it is\");\r\n    }\r\n}\r\n\r\n?>\r\n```\r\n\r\nA controller class can have different methods that are called by the framework to handle different url requests.\r\n\r\n* `get()` : handles GET requests\r\n* `post()` : handles POST requests\r\n* in general *`method()`* handles HTTP request of type *method*\r\n* `get_foo()` : handles GET requests for urls of form *&lt;controller&gt;/foo/*\r\n* `get_foo($x, $y)` : handles GET requests for urls of form *&lt;controller&gt;/foo/x/y/* where `x` and `y` are again passed as parameters to the method\r\n* `post_foo()` : similar to `get_foo()` but handles POST requests\r\n* ...\r\n\r\n### Templates\r\n\r\nTemplates are basic text pages, mostly HTML documents, that can be used as views or can be directly displayed by routing a path to it.\r\n\r\nTODO Template tags\r\n\r\n### Models\r\n\r\nEach database table can be accessed with a simple `Model`, where the schema is defined using array of properties. Each property is an array defining the name of the field, its type and other attributes like max_length.\r\n\r\n```php\r\n<?php\r\nrequire_once \"../classes/Model.php\";\r\n\r\nclass Example extends Model\r\n{\r\n    public function get_schema() {\r\n        // schema is array of properties\r\n        // each property being the tuple: (field-name, type, [attribute,...])\r\n\r\n        return array(\r\n            array(\"example_data\", \"string\", \"max_length\"=>12),\r\n            array(\"example_data2\", \"string\", \"extra\"=>\"UNIQUE\"),\r\n            array(\"example_data3\", \"integer\")\r\n            array(\"example_data4\", \"datetime\")\r\n        );\r\n    }\r\n\r\n    public $example_data3 = 15; // default value\r\n}\r\n\r\n?>\r\n```\r\n\r\nNew data can be saved in a table, by calling the `save()` in an instance.\r\n\r\n```php\r\n$test = new Example();\r\n$test->example_data = \"hello\";\r\n$test->example_data2 = \"world\";\r\n$test->example_data4 = new DateTime();\r\n$test->save();\r\n```\r\n\r\nOne can easily query objects with raw sql queries or using the built-in query builder.\r\n\r\n```php\r\n// Get all users\r\n$users = User::get_all();\r\n$users = User::query()->get();\r\n\r\n// Raw query\r\n$users = User::raw_query(\"SELECT * FROM user WHERE first_name='Bibek' AND last_name='Dahal'\");\r\n\r\n// Query-Builder: Filter users (unsafe)\r\n$users = User::query()->where(\"first_name='Bibek' AND last_name='Dahal'\")->get();\r\n\r\n// Query-Builder: Filter users (safe)\r\n$users = User::query()->where(\"first_name=? AND last_name=?\", \"Bibek\", \"Dahal\")->get();\r\n\r\n// Query-Builder: Filter and project only the last name\r\n$users = User::query()->where(\"first_name=?\", \"Bibek\")->select(\"last_name\")->get();\r\n```\r\n\r\n### Migrations\r\n\r\nEvery time, you create a model and define its schema, and every time you change schema of any model, you should *migrate* the changes for them to be reflected in your database.\r\n\r\nEach migration is defined by the sql statements that perform the required changes to the database. The migration is stored in a file *&lt;table_name&gt;_&lt;version&gt;.sql* inside the *migrations* directory. The version of each schema is kept tracked by a special table *schema_versions* in the database. This way, any new migration can be detected and applied whenever required. Note that you do not need to create these migration files yourself, though you can if you need to.\r\n\r\nTwo utilities `makemigration` and `migrate`, which are basically php scripts, are available for migration purposes. The `makemigration` command automatically detects any new changes in the schema definition and generates a migration file with naming convention mentioned above. The `migrate` command then apply any new migrations present for a model, effectively changing the database.\r\n\r\n```bash\r\nphp makemigration MyModel\r\nphp migrate MyModel\r\n```\r\n\r\n\r\n### Authentication and Session\r\n\r\n*fiber* provides some utility functions for basic session and authentication handling.\r\n\r\n`Session` class provides static functions for simple session data handling.\r\n\r\n```php\r\nSession::store(\"key\", \"value\");\r\nSession::remove(\"key\");\r\n$value = Session::get(\"key\");\r\nSession::reset();\r\nSession::destroy();\r\n```\r\n\r\n`Auth` class provides authentication related functions, again all static, and uses the `Session` class for remembering logged-in users across pages. For this, it stores the user's id in the session variable *user*.\r\n\r\nTo work with these functions, you must have some `User` model class, which extends from `Model` and has `id : integer` and `password : string(max_length >= 255)` fields. Note that the password field stores a hash value concatenated with other info including salt and hashing method used, as returned by the php `password_hash()` method.\r\n\r\n```php\r\n// Assuming you have a User model class with id and password fields\r\n\r\n// Set password field of the user object, automatically performing the hashing\r\nAuth::set_password($user, $password);\r\n\r\n// Verify password for the user object, checking for valid hash\r\nif (Auth::verify_user($user, $password)) { /*...*/ }\r\n\r\n// Login with the user object for the current session\r\nAuth::login($user);\r\n\r\n// Logout from the current session\r\nAuth::logout();\r\n\r\n// Get currently logged-in user object, null if no-one is logged in\r\n// Note that the 'User' is your custom model class name\r\n$user = Auth::get_user(\"User\");\r\n\r\n// Verify password for the user object and login when verified\r\nif (Auth::authenticate($user, $password)) { /*...*/ }\r\n```\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}